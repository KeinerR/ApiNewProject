function agregarDomicilio() {
    const pedidoId = document.getElementById('PedidoId').value;
    const usuarioId = document.getElementById('UsuarioId').value;
    const observacion = document.getElementById('Observacion').value;
    const fechaentrega = document.getElementById('FechaEntrega').value;
    const direccionDomiciliario = document.getElementById('DireccionDomiciliario').value;
    const estadoDomicilio = document.getElementById('EstadoDomicilio').value;

    const domicilioObjeto = {
        PedidoId: pedidoId,
        UsuarioId: usuarioId,
        Observacion: observacion,
        FechaEntrega: fechaentrega,
        DireccionDomiciliario: direccionDomiciliario,
        EstadoDomicilio: estadoDomicilio
    };

    fetch('https://localhost:7013/api/Domicilios/InsertDomicilio', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(domicilioObjeto)
    })
        .then(response => {
            if (!response.ok) {
                throw new Error('Ocurrió un error al enviar la solicitud.');
            }
            return response.json();
        })
        .then(data => {
            console.log('Respuesta del servidor:', data);
            location.reload(); // Recargar la página
        })
        .catch(error => {
            console.error('Error:', error);
        });
}



function obtenerDatosDomicilio(domicilioId) {
    fetch(`https://localhost:7013/api/Domicilios/GetDomicilioById?Id=${domicilioId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Error al obtener los datos de la domicilio.');
            }
            return response.json();
        })
        .then(domicilio => {
            // Llenar los campos del formulario modal con los datos del cliente
            document.getElementById('DomicilioId').value = domicilio.domicilioId;
            document.getElementById('PedidoId').value = domicilio.pedidoId;
            document.getElementById('UsuarioId').value = domicilio.usuarioId;
            document.getElementById('Observacion').value = domicilio.observacion;
            document.getElementById('FechaEntrega').value = domicilio.fechaEntrega;
            document.getElementById('DireccionDomiciliario').value = domicilio.direccionDomiciliario;
            document.getElementById('EstadoDomicilio').value = domicilio.estadoDomicilio;

            // Cambiar el título de la ventana modal
            document.getElementById('TituloModal').innerText = 'Editar domicilio';
            // Ocultar el botón "Agregar" y mostrar el botón "Actualizar Usuario"
            document.getElementById('btnGuardar').style.display = 'none';
            document.getElementById('btnEditar').style.display = 'inline-block'; // Mostrar el botón "Actualizar Usuario"
        })
        .catch(error => {
            console.error('Error:', error);
        });
}

function ActualizarDomicilio() {
    const domicilioId = document.getElementById('DomicilioId').value;
    const pedidoId = document.getElementById('PedidoId').value;
    const usuarioId = document.getElementById('UsuarioId').value;
    const observacion = document.getElementById('Observacion').value;
    const fechaentrega = document.getElementById('FechaEntrega').value;
    const direccionDomiciliario = document.getElementById('DireccionDomiciliario').value;
    const estadoDomicilio = document.getElementById('EstadoDomicilio').value;

    const domicilioObjeto = {
        DomicilioId: domicilioId,
        PedidoId: pedidoId,
        UsuarioId: usuarioId,
        Observacion: observacion,
        FechaEntrega: fechaentrega,
        DireccionDomiciliario: direccionDomiciliario,
        EstadoDomicilio: estadoDomicilio
    };

    fetch(`https://localhost:7013/api/Domicilios/UpdateDomicilios`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(domicilioObjeto)
    })
        .then(response => {
            if (response.ok) {
                alert('Domicilio actualizada correctamente.');
                location.reload(true); // Recargar la página después de la actualización
            } else {
                alert("Error en la actualización. Por favor, inténtalo de nuevo más tarde.");
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert("Error en la actualización. Por favor, inténtalo de nuevo más tarde.");
        });
}

function eliminarDomicilio(domicilioId) {
    // Hacer la solicitud DELETE al servidor para eliminar la domicilio
    fetch(`https://localhost:7013/api/Domicilios/DeleteDomicilio/${domicilioId}`, {
        method: 'DELETE',
    })
        .then(response => {
            if (!response.ok) {
                throw new Error('Error al eliminar la domicilio.');
            }
            // Aquí puedes manejar la respuesta si es necesario
            console.log('Domicilio eliminado correctamente.');
            // Recargar la página o actualizar la lista de clientes, según sea necesario
            location.reload(); // Esto recarga la página
        })
        .catch(error => {
            console.error('Error:', error);
        });
}

function limpiarFormulario() {
    // Limpiar los valores de los campos del formulario
    document.getElementById('DomicilioId').value = '';
    document.getElementById('PedidoId').value = '';
    document.getElementById('UsuarioId').value = '';
    document.getElementById('Observacion').value = '';
    document.getElementById('FechaEntrega').value = '';
    document.getElementById('DireccionDomiciliario').value = '';
    document.getElementById('EstadoDomicilio').value = '';
    document.getElementById('TituloModal').innerText = 'Agregar Domicilio';
    document.getElementById('btnGuardar').style.display = 'inline-block'; // Mostrar el botón "Actualizar Usuario"
    document.getElementById('btnEditar').style.display = 'none';
}

function buscarDomicilios() {
    var searchTerm = $('#searchInput').val().toLowerCase();

    // Filtra las filas de la tabla basándose en el término de búsqueda
    $('tbody tr').each(function () {
        var filaVisible = false;

        // Itera sobre cada campo de la fila en la tabla de domicilios
        $(this).find('.domicilio-id, .pedido-id, .usuario-id, .observacion, .fecha-entrega, .direccion-domiciliario').each(function () {
            var textoCampo = $(this).text().toLowerCase();

            // Comprueba si el término de búsqueda está presente en el campo
            if (textoCampo.indexOf(searchTerm) !== -1) {
                filaVisible = true;
                return false; // Rompe el bucle si se encuentra una coincidencia en la fila
            }
        });

        // Muestra u oculta la fila según si se encontró una coincidencia
        if (filaVisible) {
            $(this).show();
        } else {
            $(this).hide();
        }
    });

    // Mostrar u ocultar el botón de limpiar búsqueda según si hay texto en el campo de búsqueda
    if (searchTerm !== '') {
        $('#btnClearSearch').show();
    } else {
        $('#btnClearSearch').hide();
    }
}

// Ocultar el botón de limpiar búsqueda al principio
$(document).ready(function () {
    $('#btnClearSearch').hide(); // Ocultar el botón de limpiar búsqueda al cargar la página
});

// Evento de clic en el botón de búsqueda
$('#btnNavbarSearch').on('click', function () {
    buscarDomicilios();
});

// Evento de clic en el icono de búsqueda
$('#btnNavbarSearch i').on('click', function () {
    buscarDomicilios();
});

// Evento de presionar Enter en el campo de búsqueda
$('#searchInput').on('keypress', function (e) {
    if (e.which === 13) { // Verificar si se presionó la tecla Enter
        buscarDomicilios();
        e.preventDefault(); // Evitar la acción por defecto del Enter (puede ser un envío de formulario)
    }
});

// Evento de clic en el botón para limpiar la búsqueda
$('#btnClearSearch').on('click', function () {
    // Limpiar el campo de búsqueda
    $('#searchInput').val('');
    // Mostrar todos los registros ocultados previamente
    $('tbody tr').show();
    // Ocultar el botón de limpiar búsqueda al limpiar la búsqueda
    $(this).hide();
});
